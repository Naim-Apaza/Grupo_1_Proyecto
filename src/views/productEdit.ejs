<!DOCTYPE html>
<html lang="en">
  <!-- Encabezado -->
  <%- include('./partials/head')%>
  <body>
    <!-- Barra de navegacion -->
    <%- include('./partials/header') %>

    <!-- Contenido principal -->
    <main class="edit-main">
      <div class="edit-header">
        <img class="header-logo" src="/images/gz-logo.png" alt="logo" />
      </div>
      <div class="edit-container">
        <h1 class="edit-title">Editar</h1>
        <form
          action="/products/edit/<%= producto.id_producto || id %>?_method=PUT"
          class="edit-form"
          method="post"
          enctype="multipart/form-data"
        >
          <div class="field">
            <label class="label" for="nombre">Juego</label>
            <input
              class="input"
              id="nombre"
              type="text"
              name="nombre"
              value="<%= producto.nombre %>  "
              placeholder="Inserte un nombre..."
              required
            />
          </div>
          <div class="field">
            <label class="label" for="precio">Precio</label>
            <input
              class="input"
              type="number"
              step="any"
              id="precio"
              maxlength="7"
              minlength="1"
              max="99999"
              min="0"
              value="<%= producto.precio %>"
              name="precio"
              placeholder="Introduzca el valor del juego..."
              required
            />
          </div>
          <div class="field">
            <label class="label" for="descuento">Descuento</label>
            <input
              id="descuento"
              class="input"
              type="number"
              name="descuento"
              min="0"
              max="100"
              maxlength="3"
              minlength="1"
              value="<%= producto.cant_desc || producto.descuento%>"
              placeholder="Introduzca el descuento (opcional)"
            />
          </div>
          <div class="field">
            <label class="label" for="plataforma">Plataformas</label>
            <select name="plataforma" size="5" required id="plataforma">
              <% for(let i = 0;i < plataformas.length;i++) { %> 
                <% if(producto.plataformas.id_plataforma == plataformas[i].id_plataforma || producto.plataforma == plataformas[i].id_plataforma) { %>
                  <option value="<%= plataformas[i].id_plataforma %>" selected>
                    <%=plataformas[i].nombre %>
                  </option>
                <% } else { %>
                  <option value="<%= plataformas[i].id_plataforma %>">
                    <%=plataformas[i].nombre %>
                  </option>
                <% } %> 
              <% } %>
            </select>
          </div>
          <div class="field">
            <label class="label" for="tag">Categoría</label>
            <select name="tag" multiple required id="tag">
              <% if (producto.tag) { %>
                <% producto.tag.forEach((seleccionada) => { %>
                  <option value="<%= seleccionada.id_categoria %>" selected><%= seleccionada.nombre %></option>
                 <% }) %>
              <% } else { %>
                <% producto.categorias.forEach((categoria) => { %>
                  <option value="<%= categoria.id_categoria %>" selected><%= categoria.nombre %></option>
                 <% }) %>
              <% } %>
              <% categorias.forEach((categoria) => { %>
               <option value="<%= categoria.id_categoria %>"><%= categoria.nombre %></option>
              <% }) %>
            </select>
          </div>
          <div class="field-img">
            <label class="label" for="imagen">Imagen</label>
            <% if (producto.img_prod || imagen) { %>
              <img class="img" src="/images/products/<%= producto.img_prod || imagen %>" alt="<%= producto.nombre %>">
            <% } else { %>
              <img class="img" src="" alt="">
            <% } %>
            <input
              class="input"
              type="file"
              name="imagen"
              id="imagen"
            />
          </div>
          <div class="detail">
            <label for="detalle" class="label">Descripción</label>
            <textarea
              required
              id="detalle"
              name="detalle"
              cols="30"
              rows="10"
              placeholder="Introduzca una descripcion del juego.."
            ><%= producto.descripcion || producto.detalle %>
            </textarea>
          </div>
          <button class="editar-button" type="submit">Guardar cambios</button>
        </form>
      </div>
    </main>

    <!-- Footer -->
    <%- include('./partials/footer') %>
    <script src="/js/createProduct.js"></script>
    <script src="/js/imgView.js"></script>
  </body>
</html>
